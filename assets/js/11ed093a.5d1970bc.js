"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[902],{1169:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var s=r(5893),t=r(1151);const i={slug:"/deploy-in-memory-signer",sidebar_position:3},o="Deploy an In-Memory Signer",a={id:"deploy-in-memory-signer",title:"Deploy an In-Memory Signer",description:"At the end of this guide, you will get the secret Remote Signer URL for an in-memory signer lambda based on Taquito, useful for paying delegation rewards of a Tezos Baker.",source:"@site/docs/deploy-in-memory-signer.md",sourceDirName:".",slug:"/deploy-in-memory-signer",permalink:"/tezos-serverless-signer-apps/deploy-in-memory-signer",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/deploy-in-memory-signer.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{slug:"/deploy-in-memory-signer",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Deploy a Consensus Signer",permalink:"/tezos-serverless-signer-apps/deploy-consensus-signer"},next:{title:"Register your Consensus Key",permalink:"/tezos-serverless-signer-apps/register-consensus-key"}},l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Optional: import a private key",id:"optional-import-a-private-key",level:2},{value:"Install the tezos-in-memory-signer app",id:"install-the-tezos-in-memory-signer-app",level:2},{value:"Retrieve the Signer URL",id:"retrieve-the-signer-url",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"deploy-an-in-memory-signer",children:"Deploy an In-Memory Signer"}),"\n",(0,s.jsxs)(n.p,{children:["At the end of this guide, you will get the secret ",(0,s.jsx)(n.strong,{children:"Remote Signer URL"})," for an in-memory signer lambda based on Taquito, useful for paying delegation rewards of a Tezos Baker."]}),"\n",(0,s.jsx)(n.p,{children:"Unlike the Consensus Signer, the in-memory signer keeps a key in memory and stores it in Amazon Secrets Manager for long-term storage."}),"\n",(0,s.jsx)(n.p,{children:"Therefore, it is possible to extract the key. Using is as baking key is possible but strongly discouraged."}),"\n",(0,s.jsx)(n.p,{children:"This signer supports any Tezos key prefix (tz1, tz2, tz3 or tz4)."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Warning"}),": access to this signer URL allows signing any operation, including transfer."]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.p,{children:"You need:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"an AWS account"}),"\n",(0,s.jsx)(n.li,{children:"pick a region close to the rest of your infrastructure - if you are deploying the consensus signer, deploy this signer in the same region"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"optional-import-a-private-key",children:"Optional: import a private key"}),"\n",(0,s.jsx)(n.p,{children:"If you already have a payout account set up, you may import it into Amazon Secrets Manager:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["go to ",(0,s.jsx)(n.a,{href:"https://aws.amazon.com/secrets-manager/",children:"AWS Secrets Manager"})," console"]}),"\n",(0,s.jsx)(n.li,{children:"on the top right, select the proper region"}),"\n",(0,s.jsx)(n.li,{children:'select "Store a new secret"'}),"\n",(0,s.jsx)(n.li,{children:'as "Secret Type", pick "Other type of secret"'}),"\n",(0,s.jsxs)(n.li,{children:['under "Key/Value pairs", enter ',(0,s.jsx)(n.code,{children:"secretKey"})," in the left text field (key)"]}),"\n",(0,s.jsxs)(n.li,{children:["in the right text field, enter your secret key. If tz1, it should start with ",(0,s.jsx)(n.code,{children:"edsk..."}),". Omit ",(0,s.jsx)(n.code,{children:"unencrypted:"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:['leave "Encrpytion Key" unchanged as ',(0,s.jsx)(n.code,{children:"aws/secretsmanager"})]}),"\n",(0,s.jsx)(n.li,{children:'in the next screen, under "Secret Name", enter "Acme-Bakery-Payout-Key" (replace with your bakery name)'}),"\n",(0,s.jsx)(n.li,{children:"leave the default selected in the next 2 screens"}),"\n",(0,s.jsx)(n.li,{children:"finally, when your secret is created, select it and copy the secret ARN."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The ARN should look as:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"arn:aws:secretsmanager:us-east-2:01234678901:secret:Acme-Bakery-Payout-Key-GWko9y\n"})}),"\n",(0,s.jsx)(n.h2,{id:"install-the-tezos-in-memory-signer-app",children:"Install the tezos-in-memory-signer app"}),"\n",(0,s.jsxs)(n.p,{children:["From the ",(0,s.jsx)(n.a,{href:"https://us-east-2.console.aws.amazon.com/lambda/home?region=us-east-2#/applications",children:"AWS Lambda Console"}),', on the left sidebar, select "Applications", then click "Create application". Then, choose "Serverless Application".']}),"\n",(0,s.jsx)(n.p,{children:'In the search bar, enter "tezos" and select "Show apps that create custom IAM roles or resource policies". Then, pick "tezos-in-memory-signer"'}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'under "Application name", enter "ACME-Bakery-Payout-Signer" (replace with your bakery name).'}),"\n",(0,s.jsx)(n.li,{children:'under "SecretArn", enter the ARN of the private key secret created above.'}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:'Then, select "I acknowledge" and click "Deploy".'}),"\n",(0,s.jsx)(n.h2,{id:"retrieve-the-signer-url",children:"Retrieve the Signer URL"}),"\n",(0,s.jsx)(n.p,{children:"Wait one to 2 minutes and observe your resources being created."}),"\n",(0,s.jsx)(n.p,{children:'Then, select the "Deployments" tab and click the "CloudFormation stack" link.'}),"\n",(0,s.jsx)(n.p,{children:'Then, select the "Outputs" tab.'}),"\n",(0,s.jsxs)(n.p,{children:["Retrieve the ",(0,s.jsx)(n.strong,{children:"SignerURL"})," value: this is the URL of your Remote Signer."]}),"\n",(0,s.jsxs)(n.p,{children:["You may test your signer URL with ",(0,s.jsx)(n.code,{children:"curl"})," by removing the public key hash from the URL and replacing it with ",(0,s.jsx)(n.code,{children:"authorized_keys"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ curl https://l1498fpieb.execute-api.us-east-2.amazonaws.com/prod/c28e79b248a8db9d0a4f7a33af2c5a3e/authorized_keys\n"})}),"\n",(0,s.jsx)(n.p,{children:"You should see the empty set in response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"{}\n"})}),"\n",(0,s.jsx)(n.p,{children:"You may now pass this remote signer URL to your payout engine (TRD, TezPay)."}),"\n",(0,s.jsx)(n.p,{children:"Keep it safe - anyone with the key can spend the rewards."})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>a,a:()=>o});var s=r(7294);const t={},i=s.createContext(t);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);